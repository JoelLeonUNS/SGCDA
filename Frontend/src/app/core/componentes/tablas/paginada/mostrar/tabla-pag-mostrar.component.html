<div nz-flex [nzVertical]="false" nzGap="large" nzAlign="start">
  <app-buscador-tabla
    [columnasBusqueda]="columnasBusqueda"
    (columnaBusquedaChange)="buscarColumna($event)"
    [columnaBusqueda]="columna"
    (terminoBusquedaChange)="buscarTermino($event)"
    [terminoBusqueda]="termino"
    style="width: 100%"
  />
  <nz-divider nzType="vertical" style="margin: 0.75em 0"></nz-divider>
  <div nz-flex [nzVertical]="false" nzGap="small" nzAlign="center">
    <span>Reiniciar</span>
    <button nz-button (click)="reiniciarFiltros()">
      <span nz-icon nzType="filter" nzTheme="outline"></span>
    </button>
    <button nz-button (click)="reiniciarOrden()">
      <span nz-icon nzType="sort-ascending" nzTheme="outline"></span>
    </button>
  </div>
</div>
<nz-table
  #tabla
  nzShowSizeChanger
  [nzShowTotal]="totalTemplate"
  [nzData]="datos$ | async"
  [nzFrontPagination]="false"
  [nzLoading]="loading"
  [nzTotal]="total"
  [nzPageIndex]="parametros?.pageIndex??1"
  [nzPageSize]="parametros?.pageSize??10"
  (nzQueryParams)="onQueryParamsChange($event)"
  [nzScroll]="scroll == undefined ? { y: '400px' } : scroll"
  nzSize="small"
>
  <thead>
    <tr>
      @for (c of columnas; track c) {
      <th
        [nzColumnKey]="c.columnKey??c.attribute"
        [nzWidth]="c.width??null"
        [nzShowSort]="c.showSort"
        [nzSortOrder]="c.sortOrder?? null"
        [nzSortFn]="c.sortFn??null"
        [nzSortDirections]="c.sortDirections??[]"
        [nzShowFilter]="c.showFilter"
        [nzFilters]="c.listOfFilter??[]"
        [nzFilterFn]="c.filterFn??null"
        [nzFilterMultiple]="c.filterMultiple??false"
        [nzLeft]="c.left??false"
        [nzRight]="c.right??false"
        >
        {{ c.name }}
      </th>
      }
    </tr>
  </thead>
  <tbody>
    @for (data of tabla.data; track data) {
    <tr (click)="mostrar(data)">
      @for (c of columnas; track c) { @if(c.attribute != undefined) {
      <td [nzLeft]="c.left??false"
          [nzAlign]="c.align??'left'">
        @if(c.etiquetable) {
          <nz-tag [nzColor]="tags[data[c.attribute]] ? tags[data[c.attribute]].color : 'default'">
            {{ transPipe(data[c.attribute], c.pipe) }}</nz-tag
          >
        } @else {
          {{
            transPipe(data[c.attribute], c.pipe)
          }}
        }
      </td>
      }
    }
    </tr>
    }
  </tbody>
</nz-table>
<ng-template #totalTemplate let-total>Se encontraron {{ total }} registros</ng-template>
<ng-container #vcrModal></ng-container>
